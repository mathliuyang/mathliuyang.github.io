<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¦æœ¯æç¤ºè¯ç”Ÿæˆå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg: #000000;
            --text: #ffffff;
            --text-dim: #666666;
            --accent: #ffffff;
            --border: rgba(255, 255, 255, 0.08);
            --card-bg: rgba(255, 255, 255, 0.03);
        }

        [data-theme="light"] {
            --bg: #ffffff;
            --text: #000000;
            --text-dim: #999999;
            --accent: #000000;
            --border: rgba(0, 0, 0, 0.08);
            --card-bg: rgba(0, 0, 0, 0.03);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.8;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            letter-spacing: -0.02em;
            min-height: 100vh;
        }

        nav {
            position: fixed;
            top: 0;
            width: 100%;
            padding: 1.5rem 4rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
        }

        [data-theme="light"] nav {
            background: rgba(255, 255, 255, 0.8);
        }

        .logo {
            font-size: 1rem;
            font-weight: 600;
            letter-spacing: 0.05em;
            cursor: pointer;
        }

        .nav-right {
            display: flex;
            gap: 3rem;
            align-items: center;
        }

        .nav-links {
            display: flex;
            gap: 2.5rem;
            list-style: none;
        }

        .nav-links a {
            color: var(--text);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            letter-spacing: 0.02em;
            transition: color 0.3s ease;
            opacity: 0.6;
        }

        .nav-links a:hover,
        .nav-links a.active {
            opacity: 1;
        }

        .back-btn {
            display: inline-block;
            margin: 2rem 0;
            padding: 0.8rem 1.5rem;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            letter-spacing: 0.02em;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            border-color: var(--text);
            color: var(--bg);
            background: var(--text);
        }

        .theme-btn {
            width: 36px;
            height: 36px;
            border: 1px solid var(--border);
            background: transparent;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .theme-btn:hover {
            border-color: var(--text);
            transform: scale(1.1);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 120px 4rem 4rem;
        }

        .header {
            margin-bottom: 3rem;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 300;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        .header p {
            color: var(--text-dim);
        }

        .mode-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 3rem;
            border-bottom: 1px solid var(--border);
        }

        .tab {
            padding: 1rem 2rem;
            background: transparent;
            border: none;
            color: var(--text-dim);
            cursor: pointer;
            font-size: 0.95rem;
            letter-spacing: 0.05em;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .tab:hover {
            color: var(--text);
        }

        .tab.active {
            color: var(--text);
            border-bottom-color: var(--text);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* å¯†ç éªŒè¯æ¨¡æ€æ¡†æ ·å¼ */
        .password-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(10px);
        }

        .password-container {
            background: var(--bg);
            border: 1px solid var(--border);
            padding: 3rem;
            border-radius: 8px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .password-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--text);
        }

        .password-subtitle {
            color: var(--text-dim);
            margin-bottom: 2rem;
            font-size: 0.9rem;
        }

        .password-input {
            width: 100%;
            padding: 1rem;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text);
            font-size: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 4px;
            text-align: center;
            font-family: inherit;
            line-height: 1.4;
        }

        .password-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1);
        }

        .password-btn {
            width: 100%;
            padding: 1rem;
            background: var(--text);
            color: var(--bg);
            border: 1px solid var(--text);
            font-size: 0.9rem;
            font-weight: 500;
            letter-spacing: 0.05em;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .password-btn:hover {
            background: transparent;
            color: var(--text);
        }

        .password-error {
            color: #ff4757;
            font-size: 0.8rem;
            margin-top: 0.5rem;
            display: none;
        }

        .password-hint {
            color: var(--text-dim);
            font-size: 0.75rem;
            margin-top: 1rem;
            font-style: italic;
        }

        /* ä¸»è¦å†…å®¹åˆå§‹éšè— */
        .main-content {
            display: none;
        }

        .main-content.authenticated {
            display: block;
        }

        /* Generator Mode */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
        }

        .panel {
            border: 1px solid var(--border);
            padding: 2rem;
        }

        .panel-title {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 1.5rem;
            letter-spacing: -0.01em;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .dynamic-form-indicator {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .empty-state {
            background: var(--bg-secondary);
            border: 2px dashed var(--border);
            border-radius: 1rem;
            margin: 2rem 0;
            transition: all 0.3s ease;
        }

        .empty-state:hover {
            border-color: var(--primary);
            background: var(--bg-primary);
        }

        .form-label.required::after {
            content: ' *';
            color: #ff4757;
            font-weight: bold;
        }

        .form-label {
            display: block;
            font-size: 0.85rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            color: var(--text-dim);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-label .required {
            color: #ff4757;
            margin-left: 2px;
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 0.8rem;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text);
            font-size: 0.95rem;
            font-family: inherit;
            transition: all 0.3s ease;
            border-radius: 4px;
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--text);
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1);
        }

        .form-input.error,
        .form-textarea.error,
        .form-select.error {
            border-color: #ff4757;
            box-shadow: 0 0 0 2px rgba(255, 71, 87, 0.2);
        }

        .form-input[required],
        .form-textarea[required],
        .form-select[required] {
            position: relative;
        }

        .form-input[required]:invalid,
        .form-textarea[required]:invalid,
        .form-select[required]:invalid {
            border-color: #ff6b7a;
        }

        /* Message styles */
        .error-message {
            background-color: #fdf2f2;
            color: #e74c3c;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #e74c3c;
            margin: 10px 0;
            font-size: 14px;
        }

        .info-message {
            background-color: #f0f8ff;
            color: #2980b9;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #3498db;
            margin: 10px 0;
            font-size: 14px;
        }

        .error-text {
            color: #e74c3c;
            font-size: 12px;
            margin-top: 4px;
            display: block;
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }

        .form-select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23ffffff' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
        }

        [data-theme="light"] .form-select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23000000' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
        }

        /* åŠ¨æ€è¡¨å•ç‰¹æ®Šæ ·å¼ */
        .dynamic-form-indicator {
            position: absolute;
            top: -0.5rem;
            right: 0;
            background: var(--accent);
            color: var(--bg);
            padding: 0.2rem 0.5rem;
            font-size: 0.7rem;
            border-radius: 2px;
            font-weight: 600;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        .template-selector-group {
            margin-bottom: 2rem;
            padding: 1.5rem;
            border: 2px dashed var(--border);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.02);
            transition: all 0.3s ease;
        }

        .template-selector-group:hover {
            border-color: var(--text);
            background: rgba(255, 255, 255, 0.05);
        }

        .template-selector-group .form-label {
            color: var(--text);
            font-size: 0.9rem;
            margin-bottom: 0.8rem;
        }

        .radio-group {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .radio-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .radio-item input[type="radio"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .generate-btn {
            width: 100%;
            padding: 1rem;
            background: var(--text);
            color: var(--bg);
            border: 1px solid var(--text);
            font-size: 0.9rem;
            font-weight: 500;
            letter-spacing: 0.05em;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            margin-top: 1rem;
        }

        .generate-btn:hover {
            background: transparent;
            color: var(--text);
        }

        .output-textarea {
            width: 100%;
            min-height: 400px;
            padding: 1.5rem;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text);
            font-size: 0.95rem;
            font-family: 'Courier New', monospace;
            line-height: 1.6;
            resize: vertical;
        }

        .output-textarea:focus {
            outline: none;
            border-color: var(--text);
        }

        .output-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .action-btn {
            flex: 1;
            padding: 0.8rem;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text);
            font-size: 0.85rem;
            letter-spacing: 0.05em;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .action-btn:hover {
            background: var(--text);
            color: var(--bg);
            border-color: var(--text);
        }

        /* Templates Mode */
        .filter-section {
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border);
        }

        .filter-title {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 1.5rem;
            letter-spacing: -0.01em;
        }

        .filter-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 0.8rem 1.5rem;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-dim);
            font-size: 0.85rem;
            font-weight: 500;
            letter-spacing: 0.02em;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 4px;
            white-space: nowrap;
        }

        .filter-btn:hover {
            color: var(--text);
            border-color: var(--text);
        }

        .filter-btn.active {
            background: var(--text);
            color: var(--bg);
            border-color: var(--text);
        }

        .templates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2rem;
        }

        .template-card {
            border: 1px solid var(--border);
            padding: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .template-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: var(--accent);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .template-card:hover::before {
            transform: scaleX(1);
        }

        .template-card:hover {
            border-color: var(--text);
            transform: translateY(-5px);
        }

        .template-cover {
            width: 100%;
            height: 120px;
            margin-bottom: 1.5rem;
            border-radius: 4px;
            overflow: hidden;
            background: var(--border);
            position: relative;
        }

        .template-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .template-card:hover .template-cover img {
            transform: scale(1.05);
        }

        .template-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .template-name {
            font-size: 1.3rem;
            font-weight: 500;
            margin-bottom: 0.8rem;
        }

        .template-desc {
            font-size: 0.9rem;
            color: var(--text-dim);
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .template-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .tag {
            padding: 0.3rem 0.8rem;
            border: 1px solid var(--border);
            font-size: 0.75rem;
            letter-spacing: 0.05em;
            color: var(--text-dim);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--bg);
            border: 1px solid var(--border);
            max-width: 900px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            padding: 3rem;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            width: 40px;
            height: 40px;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text);
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            border-color: var(--text);
            background: var(--text);
            color: var(--bg);
        }

        .modal-title {
            font-size: 2rem;
            font-weight: 300;
            margin-bottom: 2rem;
        }

        .modal-template {
            background: var(--border);
            padding: 2rem;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.8;
            white-space: pre-wrap;
            margin-bottom: 2rem;
            max-height: 400px;
            overflow-y: auto;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
        }

        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            background: var(--text);
            color: var(--bg);
            border: 1px solid var(--text);
            font-size: 0.9rem;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            pointer-events: none;
            z-index: 1000;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            nav {
                padding: 1rem 2rem;
            }

            .container {
                padding: 100px 2rem 2rem;
            }

            .mode-tabs {
                overflow-x: auto;
            }

            .templates-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                padding: 2rem 1.5rem;
            }

            .modal-actions {
                flex-direction: column;
            }
        }
    </style>
</head>

<body>
    <!-- å¯†ç éªŒè¯æ¨¡æ€æ¡† -->
    <div id="passwordModal" class="password-modal">
        <div class="password-container">
            <h2 class="password-title">è®¿é—®éªŒè¯</h2>
            <p class="password-subtitle">è¯·è¾“å…¥è®¿é—®å¯†ç ä»¥ä½¿ç”¨å­¦æœ¯æç¤ºè¯ç”Ÿæˆå™¨</p>
            <input type="text" id="passwordInput" class="password-input" placeholder="è¯·è¾“å…¥å¯†ç " autocomplete="off"
                autocapitalize="off" autocorrect="off">
            <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                <a href="../pages/tools.html" class="password-btn"
                    style="flex: 1; background: transparent; color: var(--text); text-decoration: none; text-align: center;">è¿”å›å·¥å…·é›†</a>
                <button onclick="checkPassword()" class="password-btn" style="flex: 1;">éªŒè¯</button>
            </div>
            <div id="passwordError" class="password-error">å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•</div>
            <p class="password-hint">åŠŸèƒ½æµ‹è¯•ä¸­ï¼Œæš‚æœªå¼€æ”¾</p>
        </div>
    </div>

    <!-- ä¸»è¦å†…å®¹å®¹å™¨ -->
    <div id="mainContent" class="main-content">
        <nav>
            <div class="logo" onclick="location.href='../index.html'">å›¾çµçš„çŒ« X æ™ºæ ¸å­¦æœ¯</div>
            <div class="nav-right">
                <ul class="nav-links">
                    <li><a href="../index.html">é¦–é¡µ</a></li>
                    <li><a href="../pages/about.html">å…³äºæˆ‘</a></li>
                    <li><a href="../pages/blog.html">åšå®¢</a></li>
                    <li><a href="../pages/projects.html">é¡¹ç›®</a></li>
                    <li><a href="../pages/publications.html">å­¦æœ¯æˆæœ</a></li>
                    <li><a href="../pages/tools.html" class="active">å·¥å…·ç®±</a></li>
                    <li><a href="../pages/contact.html">è”ç³»æˆ‘</a></li>
                </ul>
                <button class="theme-btn" id="themeBtn">
                    <span id="themeIcon">â—</span>
                </button>
            </div>
        </nav>

        <div class="container">
            <div class="header">
                <h1>å­¦æœ¯æç¤ºè¯ç”Ÿæˆå™¨</h1>
                <p>æ™ºèƒ½ç”Ÿæˆé«˜è´¨é‡çš„å­¦æœ¯å†™ä½œæç¤ºè¯ï¼Œæˆ–ä»æ¨¡æ¿åº“ä¸­é€‰æ‹©é¢„è®¾æç¤ºè¯</p>
            </div>

            <div class="mode-tabs">
                <button class="tab active" onclick="switchTab('generator')">æ™ºèƒ½ç”Ÿæˆ</button>
                <button class="tab" onclick="switchTab('templates')">æ¨¡æ¿åº“</button>
            </div>

            <!-- Generator Mode -->
            <div id="generator" class="tab-content active">
                <div class="main-grid">
                    <div class="panel">
                        <h2 class="panel-title">é…ç½®å‚æ•°</h2>

                        <div class="template-selector-group">
                            <label class="form-label">é€‰æ‹©æ¨¡æ¿</label>
                            <select class="form-select" id="templateSelect" onchange="loadTemplate()">
                                <option value="">è¯·é€‰æ‹©æ¨¡æ¿...</option>
                            </select>
                        </div>

                        <!-- åŠ¨æ€è¡¨å•å®¹å™¨ -->
                        <div id="dynamicForm">
                            <!-- æœªé€‰æ‹©æ¨¡æ¿æ—¶çš„ç©ºçŠ¶æ€ -->
                            <div class="empty-state">
                                <div style="text-align: center; padding: 3rem 0; color: var(--text-dim);">
                                    <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“</div>
                                    <h3 style="margin-bottom: 1rem; color: var(--text);">é€‰æ‹©æ¨¡æ¿å¼€å§‹ä½¿ç”¨</h3>
                                    <p>è¯·ä»ä¸Šæ–¹é€‰æ‹©æ¨¡æ¿</p>
                                </div>
                            </div>
                        </div>

                        <button class="generate-btn" onclick="generatePrompt()">ç”Ÿæˆæç¤ºè¯</button>
                    </div>

                    <div class="panel">
                        <h2 class="panel-title">ç”Ÿæˆç»“æœ</h2>
                        <textarea class="output-textarea" id="output" placeholder="é…ç½®å‚æ•°åç‚¹å‡»ç”Ÿæˆ..."></textarea>
                        <div class="output-actions">
                            <button class="action-btn" onclick="copyOutput()">å¤åˆ¶</button>
                            <button class="action-btn" onclick="savePrompt()">ä¿å­˜</button>
                            <button class="action-btn" onclick="clearOutput()">æ¸…ç©º</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Templates Mode -->
            <div id="templates" class="tab-content">
                <!-- ç­›é€‰åŠŸèƒ½ -->
                <div class="filter-section">
                    <h3 class="filter-title">æŒ‰æ¥æºç­›é€‰</h3>
                    <div class="filter-buttons">
                        <button class="filter-btn active" data-category="all"
                            onclick="filterTemplates('all')">å…¨éƒ¨</button>
                        <button class="filter-btn" data-category="å›½è‡ªç§‘åŸºé‡‘ç”³è¯·æŒ‡ä»¤"
                            onclick="filterTemplates('å›½è‡ªç§‘åŸºé‡‘ç”³è¯·æŒ‡ä»¤')">å›½è‡ªç§‘åŸºé‡‘ç”³è¯·æŒ‡ä»¤</button>
                        <button class="filter-btn" data-category="SCIè®ºæ–‡å†™ä½œå…¨æŒ‡å—"
                            onclick="filterTemplates('SCIè®ºæ–‡å†™ä½œå…¨æŒ‡å—')">SCIè®ºæ–‡å†™ä½œå…¨æŒ‡å—</button>
                        <button class="filter-btn" data-category="å¸¸ç”¨å·¥å…·" onclick="filterTemplates('å¸¸ç”¨å·¥å…·')">å¸¸ç”¨å·¥å…·</button>
                    </div>
                </div>
                <div class="templates-grid" id="templatesGrid"></div>
            </div>
        </div>

        <!-- Template Modal -->
        <div class="modal" id="templateModal">
            <div class="modal-content">
                <button class="modal-close" onclick="closeModal()">Ã—</button>
                <h2 class="modal-title" id="modalTitle"></h2>
                <div class="modal-template" id="modalTemplate"></div>
                <div class="modal-actions">
                    <button class="action-btn" onclick="copyTemplate()">å¤åˆ¶æç¤ºè¯</button>
                    <button class="action-btn" onclick="useTemplate()">ä½¿ç”¨æ­¤æ¨¡æ¿</button>
                </div>
            </div>
        </div>

        <div class="toast" id="toast"></div>

        <script>
            // Theme toggle
            const themeBtn = document.getElementById('themeBtn');
            const themeIcon = document.getElementById('themeIcon');
            const currentTheme = localStorage.getItem('theme') || 'light';

            document.documentElement.setAttribute('data-theme', currentTheme);
            themeIcon.textContent = currentTheme === 'dark' ? 'â—' : 'â—‘';

            // æ·»åŠ å›¾æ ‡é¢œè‰²æ ·å¼ï¼Œç¡®ä¿åœ¨ä¸åŒä¸»é¢˜ä¸‹éƒ½æ¸…æ™°å¯è§
            themeIcon.style.color = currentTheme === 'dark' ? '#ffffff' : '#000000';

            themeBtn.addEventListener('click', () => {
                const theme = document.documentElement.getAttribute('data-theme');
                const newTheme = theme === 'dark' ? 'light' : 'dark';

                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                themeIcon.textContent = newTheme === 'dark' ? 'â—' : 'â—‘';
                themeIcon.style.color = newTheme === 'dark' ? '#ffffff' : '#000000';
            });

            // Template Library - ä»ç‹¬ç«‹JSæ–‡ä»¶åŠ è½½
            // templateså¯¹è±¡ç°åœ¨ä»prompt-templates.jsæ–‡ä»¶ä¸­åŠ è½½

            let currentTemplate = null;

            // Render templates
            function renderTemplates(filteredTemplates = null) {
                const grid = document.getElementById('templatesGrid');
                const templatesToRender = filteredTemplates || window.templates;

                grid.innerHTML = Object.entries(templatesToRender).map(([id, template]) => `
                <div class="template-card" onclick="showTemplateModal('${id}')">
                    ${template.cover ? `
                        <div class="template-cover">
                            <img src="${template.cover}" alt="${template.name}" onerror="this.parentElement.innerHTML='<div class=\'template-icon\'>${template.icon}</div>'">
                        </div>
                    ` : `<div class="template-icon">${template.icon}</div>`}
                    <div class="template-name">${template.name}</div>
                    <div class="template-desc">${template.desc}</div>
                    <div class="template-tags">
                        ${template.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                </div>
            `).join('');
            }

            // Filter templates by category
            function filterTemplates(category) {
                // Update active filter button
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-category="${category}"]`).classList.add('active');

                // Filter templates
                let filteredTemplates = {};

                if (category === 'all') {
                    filteredTemplates = window.templates;
                } else {
                    Object.entries(window.templates).forEach(([id, template]) => {
                        if (template.category === category) {
                            filteredTemplates[id] = template;
                        }
                    });
                }

                // Re-render templates with filtered results
                renderTemplates(filteredTemplates);
            }

            // Switch tabs
            function switchTab(tab) {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                event.target.classList.add('active');
                document.getElementById(tab).classList.add('active');

                if (tab === 'templates' && document.getElementById('templatesGrid').children.length === 0) {
                    renderTemplates();
                }
            }

            // Show template modal
            function showTemplateModal(templateId) {
                const template = window.templates[templateId];
                if (!template) return;

                currentTemplate = template;
                document.getElementById('modalTitle').textContent = template.name;
                document.getElementById('modalTemplate').textContent = template.content;
                document.getElementById('templateModal').classList.add('show');
            }

            function closeModal() {
                document.getElementById('templateModal').classList.remove('show');
                currentTemplate = null;
            }

            function copyTemplate() {
                if (!currentTemplate) return;
                navigator.clipboard.writeText(currentTemplate.content);
                showToast('æ¨¡æ¿å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            }

            // Initialize template selector
            function initializeTemplateSelector() {
                const templateSelect = document.getElementById('templateSelect');
                templateSelect.innerHTML = '<option value="">è¯·é€‰æ‹©æ¨¡æ¿...</option>';

                Object.entries(window.templates).forEach(([id, template]) => {
                    const option = document.createElement('option');
                    option.value = id;
                    option.textContent = template.name;
                    templateSelect.appendChild(option);
                });
            }

            // Initialize on page load
            document.addEventListener('DOMContentLoaded', function () {
                // ç­‰å¾…æ‰€æœ‰è„šæœ¬åŠ è½½å®Œæˆåå†åˆå§‹åŒ–
                if (typeof window.templates !== 'undefined' && Object.keys(window.templates).length > 0) {
                    initializeTemplateSelector();
                } else {
                    console.warn('Templates not loaded yet, retrying...');
                    // å¦‚æœtemplatesæœªå®šä¹‰ï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´åé‡è¯•
                    setTimeout(() => {
                        if (typeof window.templates !== 'undefined' && Object.keys(window.templates).length > 0) {
                            initializeTemplateSelector();
                        } else {
                            console.error('Failed to load templates from prompt-templates.js');
                            showToast('æ¨¡æ¿åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                        }
                    }, 100);
                }
            });

            // Load template and generate dynamic form with enhanced error handling
            function loadTemplate() {
                try {
                    const templateId = document.getElementById('templateSelect').value;
                    const dynamicForm = document.getElementById('dynamicForm');

                    if (!dynamicForm) {
                        console.error('Dynamic form element not found');
                        return;
                    }

                    if (!templateId) {
                        // Reset to empty state
                        dynamicForm.innerHTML = `
                            <div class="empty-state">
                                <div style="text-align: center; padding: 3rem 0; color: var(--text-dim);">
                                    <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“</div>
                                    <h3 style="margin-bottom: 1rem; color: var(--text);">é€‰æ‹©æ¨¡æ¿å¼€å§‹ä½¿ç”¨</h3>
                                    <p>è¯·ä»ä¸Šæ–¹é€‰æ‹©æ¨¡æ¿</p>
                                </div>
                            </div>
                        `;
                        return;
                    }

                    const template = window.templates[templateId];
                    if (!template) {
                        console.error(`Template with ID "${templateId}" not found`);
                        dynamicForm.innerHTML = '<div class="error-message">æ¨¡æ¿åŠ è½½å¤±è´¥ï¼Œè¯·é‡æ–°é€‰æ‹©</div>';
                        return;
                    }

                    // ç«‹å³æ˜¾ç¤ºå®Œæ•´çš„æ¨¡æ¿æç¤ºè¯ï¼Œè®©ç”¨æˆ·äº†è§£æ¨¡æ¿å†…å®¹
                    document.getElementById('output').value = template.content;

                    // Extract dynamic fields from template content
                    const dynamicFields = extractDynamicFields(template.content);

                    if (dynamicFields.length === 0) {
                        console.warn(`No dynamic fields found in template "${templateId}"`);
                        dynamicForm.innerHTML = '<div class="info-message">æ­¤æ¨¡æ¿æ— éœ€é¢å¤–è¾“å…¥ï¼Œå¯ç›´æ¥ä½¿ç”¨</div>';
                        return;
                    }

                    // Generate dynamic form with indicator and enhanced field types
                    let formHTML = '<div class="dynamic-form-indicator">æ¨¡æ¿æ¨¡å¼</div>';

                    dynamicFields.forEach((field, index) => {
                        try {
                            const fieldId = `dynamic_field_${index}`;
                            const requiredAttr = field.required ? 'required' : '';
                            const requiredClass = field.required ? 'required' : '';

                            let inputHTML = '';

                            switch (field.type) {
                                case 'textarea':
                                    inputHTML = `<textarea class="form-textarea" id="${fieldId}" placeholder="${field.placeholder}" ${requiredAttr}></textarea>`;
                                    break;
                                case 'url':
                                    inputHTML = `<input type="url" class="form-input" id="${fieldId}" placeholder="${field.placeholder}" ${requiredAttr}>`;
                                    break;
                                case 'email':
                                    inputHTML = `<input type="email" class="form-input" id="${fieldId}" placeholder="${field.placeholder}" ${requiredAttr}>`;
                                    break;
                                case 'number':
                                    inputHTML = `<input type="number" class="form-input" id="${fieldId}" placeholder="${field.placeholder}" ${requiredAttr}>`;
                                    break;
                                case 'date':
                                    // è‡ªå®šä¹‰æ—¥æœŸè¾“å…¥ï¼Œæ”¯æŒç›´æ¥è¾“å…¥æ•°å­—æ ¼å¼å¦‚20251208ï¼ŒæŒ‰å›è½¦é”®åè‡ªåŠ¨è¯†åˆ«ä¸º2025å¹´12æœˆ
                                    inputHTML = `<input type="text" class="form-input" id="${fieldId}" placeholder="è¯·è¾“å…¥æ—¥æœŸï¼ŒæŒ‰å›è½¦é”®è½¬æ¢ï¼š2025å¹´12æœˆ æˆ– 20251208" ${requiredAttr} 
                                                 onkeypress="handleDateInputKeyPress(event, this)" maxlength="8">`;
                                    break;
                                default:
                                    inputHTML = `<input type="text" class="form-input" id="${fieldId}" placeholder="${field.placeholder}" ${requiredAttr}>`;
                            }

                            formHTML += `
                            <div class="form-group">
                                <label class="form-label ${requiredClass}">${field.label}${field.required ? ' *' : ''}</label>
                                ${inputHTML}
                            </div>
                        `;
                        } catch (error) {
                            console.error(`Error generating form field for "${field.name}":`, error);
                            // æ·»åŠ é”™è¯¯å­—æ®µçš„åå¤‡æ˜¾ç¤º
                            formHTML += `
                            <div class="form-group">
                                <label class="form-label">${field.name}</label>
                                <input type="text" class="form-input" placeholder="è¯·è¾“å…¥${field.name}">
                                <small class="error-text">å­—æ®µé…ç½®é”™è¯¯ï¼Œä½¿ç”¨é»˜è®¤è®¾ç½®</small>
                            </div>
                        `;
                        }
                    });

                    dynamicForm.innerHTML = formHTML;
                    console.info(`Successfully loaded template "${templateId}" with ${dynamicFields.length} fields`);

                } catch (error) {
                    console.error('Error in loadTemplate:', error);
                    const dynamicForm = document.getElementById('dynamicForm');
                    if (dynamicForm) {
                        dynamicForm.innerHTML = '<div class="error-message">æ¨¡æ¿åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•</div>';
                    }
                }
            }

            // Extract dynamic fields from template content with enhanced recognition
            function extractDynamicFields(content) {
                try {
                    const fields = [];
                    const fieldPattern = /\[([^\]]+)\]/g;
                    const matches = [...content.matchAll(fieldPattern)];

                    if (matches.length === 0) {
                        console.info('No dynamic fields found in template');
                        return fields;
                    }

                    const uniqueFields = [...new Set(matches.map(match => match[1]))];
                    console.info(`Found ${uniqueFields.length} unique dynamic fields:`, uniqueFields);

                    uniqueFields.forEach(fieldName => {
                        try {
                            const fieldConfig = analyzeFieldType(fieldName);
                            fields.push({
                                name: fieldName,
                                label: fieldConfig.label,
                                placeholder: fieldConfig.placeholder,
                                type: fieldConfig.type,

                                required: fieldConfig.required
                            });
                        } catch (error) {
                            console.error(`Error analyzing field type for "${fieldName}":`, error);
                            // ä½¿ç”¨é»˜è®¤é…ç½®ä½œä¸ºåå¤‡
                            fields.push({
                                name: fieldName,
                                label: fieldName,
                                placeholder: `è¯·è¾“å…¥${fieldName}`,
                                type: 'text',
                                required: true
                            });
                        }
                    });

                    return fields;
                } catch (error) {
                    console.error('Error in extractDynamicFields:', error);
                    return [];
                }
            }

            // Analyze field type and configuration based on field name
            function analyzeFieldType(fieldName) {
                // å®šä¹‰å­—æ®µç±»å‹é…ç½®æ˜ å°„è¡¨ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
                const fieldTypeMap = {
                    url: {
                        keywords: ['ç½‘å€', 'é“¾æ¥', 'URL', 'url', 'åœ°å€'],
                        config: {
                            type: 'url',
                            placeholder: 'è¯·è¾“å…¥å®Œæ•´çš„ç½‘å€ï¼Œå¦‚ï¼šhttps://example.com',
                            required: true
                        }
                    },
                    text: {
                        keywords: ['åç§°', 'æ ‡é¢˜', 'å·¥å…·å', 'å§“å', 'ç”¨æˆ·å'],
                        config: {
                            type: 'text',
                            placeholder: 'è¯·è¾“å…¥{fieldName}',
                            required: true
                        }
                    },
                    textarea: {
                        keywords: ['æè¿°', 'ä»‹ç»', 'è¯´æ˜', 'å†…å®¹', 'ç‰¹ç‚¹', 'åŠŸèƒ½', 'è¦æ±‚', 'éœ€æ±‚', 'æ¡ä»¶', 'è¯¦æƒ…'],
                        config: {
                            type: 'textarea',
                            placeholder: 'è¯·è¯¦ç»†æè¿°{fieldName}',
                            required: true
                        }
                    },
                    number: {
                        keywords: ['ç¼–å·', 'åºå·', 'ID', 'æ•°é‡', 'å¹´é¾„', 'ä»·æ ¼'],
                        config: {
                            type: 'number',
                            placeholder: 'è¯·è¾“å…¥{fieldName}',
                            required: true
                        }
                    },
                    email: {
                        keywords: ['é‚®ç®±', 'é‚®ä»¶', 'email', 'Email'],
                        config: {
                            type: 'email',
                            placeholder: 'è¯·è¾“å…¥é‚®ç®±åœ°å€',
                            required: true
                        }
                    },
                    date: {
                        keywords: ['æ—¥æœŸ', 'æ—¶é—´', 'date', 'Date', 'å‘è¡¨æ—¶é—´', 'å‘å¸ƒæ—¶é—´'],
                        config: {
                            type: 'date',
                            placeholder: 'è¯·è¾“å…¥æ—¥æœŸï¼ŒæŒ‰å›è½¦é”®è½¬æ¢ï¼š2025å¹´12æœˆ æˆ– 20251208',
                            required: true
                        }
                    }
                };

                // é»˜è®¤é…ç½®
                let config = {
                    label: fieldName,
                    placeholder: `è¯·è¾“å…¥${fieldName}`,
                    type: 'text',
                    required: true
                };

                // éå†å­—æ®µç±»å‹æ˜ å°„è¡¨ï¼ŒåŒ¹é…å­—æ®µç±»å‹
                for (const [type, typeConfig] of Object.entries(fieldTypeMap)) {
                    if (typeConfig.keywords.some(keyword => fieldName.includes(keyword))) {
                        config = {
                            ...config,
                            ...typeConfig.config,
                            placeholder: typeConfig.config.placeholder.replace('{fieldName}', fieldName)
                        };
                        break;
                    }
                }

                // ç‰¹æ®Šå¤„ç†ï¼šå¯é€‰å­—æ®µè¯†åˆ«
                if (fieldName.includes('å¯é€‰') || fieldName.includes('é€‰å¡«') || fieldName.includes('(å¯é€‰)') || fieldName.includes('ï¼ˆå¯é€‰ï¼‰')) {
                    config.required = false;
                }

                return config;
            }

            function useTemplate() {
                if (!currentTemplate) return;

                // Switch to generator tab first
                document.querySelectorAll('.tab')[0].click();

                // Find template ID by comparing template objects
                const templateId = Object.keys(window.templates).find(key =>
                    window.templates[key].name === currentTemplate.name &&
                    window.templates[key].content === currentTemplate.content
                );

                if (templateId) {
                    // Set template in selector
                    document.getElementById('templateSelect').value = templateId;

                    // Load the template form
                    loadTemplate();
                }

                closeModal();
                showToast('æ¨¡æ¿å·²åŠ è½½åˆ°æ™ºèƒ½ç”Ÿæˆå™¨');
            }

            // Generate prompt
            function generatePrompt() {
                const templateId = document.getElementById('templateSelect').value;

                // Check if template is selected
                if (!templateId) {
                    showToast('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¨¡æ¿', 'error');
                    return;
                }

                // ä½¿ç”¨ç‰¹å®šæ¨¡æ¿ç”Ÿæˆ
                generateFromTemplate(templateId);
            }

            function generateFromTemplate(templateId) {
                try {
                    const template = window.templates[templateId];
                    if (!template) {
                        console.error(`Template not found: ${templateId}`);
                        showToast('æ¨¡æ¿æœªæ‰¾åˆ°ï¼Œè¯·é‡æ–°é€‰æ‹©');
                        return;
                    }

                    let content = template.content;
                    const dynamicFields = extractDynamicFields(content);

                    // éªŒè¯å¿…å¡«å­—æ®µ
                    const missingFields = [];
                    const fieldValues = {};
                    let hasValidationError = false;

                    dynamicFields.forEach((field, index) => {
                        const fieldId = `dynamic_field_${index}`;
                        const element = document.getElementById(fieldId);
                        if (!element) {
                            console.warn(`Field element not found: ${fieldId}`);
                            return;
                        }

                        const value = element.value.trim();

                        // é‡ç½®é”™è¯¯æ ·å¼
                        element.style.borderColor = '';

                        // æ£€æŸ¥å¿…å¡«å­—æ®µ
                        if (field.required && !value) {
                            missingFields.push(field.label);
                            element.style.borderColor = '#ff4757';
                            hasValidationError = true;
                            return;
                        }

                        // éªŒè¯URLæ ¼å¼
                        if (field.type === 'url' && value && !isValidUrl(value)) {
                            showToast(`${field.label} æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·è¾“å…¥æœ‰æ•ˆçš„ç½‘å€`);
                            element.style.borderColor = '#ff4757';
                            hasValidationError = true;
                            return;
                        }

                        // éªŒè¯é‚®ç®±æ ¼å¼
                        if (field.type === 'email' && value && !isValidEmail(value)) {
                            showToast(`${field.label} æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€`);
                            element.style.borderColor = '#ff4757';
                            hasValidationError = true;
                            return;
                        }

                        fieldValues[field.name] = value || field.placeholder;
                    });

                    // å¦‚æœæœ‰éªŒè¯é”™è¯¯ï¼Œåœæ­¢å¤„ç†
                    if (hasValidationError) {
                        return;
                    }

                    // å¦‚æœæœ‰å¿…å¡«å­—æ®µæœªå¡«å†™ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                    if (missingFields.length > 0) {
                        showToast(`è¯·å¡«å†™å¿…å¡«å­—æ®µï¼š${missingFields.join('ã€')}`);
                        return;
                    }

                    // æ›¿æ¢æ¨¡æ¿ä¸­çš„åŠ¨æ€å­—æ®µ
                    Object.entries(fieldValues).forEach(([fieldName, value]) => {
                        const pattern = new RegExp(`\\[${fieldName.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}\\]`, 'g');
                        content = content.replace(pattern, value);
                    });

                    // æ£€æŸ¥æ˜¯å¦è¿˜æœ‰æœªæ›¿æ¢çš„å­—æ®µ
                    const remainingFields = content.match(/\[[^\]]+\]/g);
                    if (remainingFields) {
                        console.warn('Unprocessed fields found:', remainingFields);
                    }

                    document.getElementById('output').value = content;
                    showToast('åŸºäºæ¨¡æ¿ç”ŸæˆæˆåŠŸï¼');

                } catch (error) {
                    console.error('Error in generateFromTemplate:', error);
                    showToast('ç”Ÿæˆè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œè¯·é‡è¯•');
                }
            }

            // éªŒè¯URLæ ¼å¼
            function isValidUrl(string) {
                try {
                    new URL(string);
                    return true;
                } catch (_) {
                    return false;
                }
            }

            // éªŒè¯é‚®ç®±æ ¼å¼
            function isValidEmail(email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            }

            // å¤„ç†æ—¥æœŸè¾“å…¥æŒ‰é”®äº‹ä»¶ - æŒ‰å›è½¦é”®åè§¦å‘æ ¼å¼è½¬æ¢
            function handleDateInputKeyPress(event, input) {
                // åªå¤„ç†å›è½¦é”®ï¼ˆEnterï¼‰
                if (event.key !== 'Enter') {
                    return;
                }

                // é˜»æ­¢é»˜è®¤è¡Œä¸º
                event.preventDefault();

                // è°ƒç”¨æ ¼å¼è½¬æ¢å‡½æ•°
                formatDateInput(input);
            }

            // æ—¥æœŸè¾“å…¥æ ¼å¼åŒ–å‡½æ•° - æ”¯æŒç›´æ¥è¾“å…¥æ•°å­—æ ¼å¼è‡ªåŠ¨è¯†åˆ«
            function formatDateInput(input) {
                const value = input.value.trim();

                // å¦‚æœè¾“å…¥ä¸ºç©ºï¼Œç›´æ¥è¿”å›
                if (!value) return;

                // å¦‚æœå·²ç»æ˜¯ä¸­æ–‡æ ¼å¼ï¼ˆåŒ…å«å¹´æˆ–æœˆï¼‰ï¼Œä¸åšå¤„ç†
                if (value.includes('å¹´') || value.includes('æœˆ')) {
                    return;
                }

                // å¤„ç†æ•°å­—æ ¼å¼ï¼š20251208 -> 2025å¹´12æœˆ
                if (/^\d{8}$/.test(value)) {
                    const year = value.substring(0, 4);
                    const month = value.substring(4, 6);
                    const day = value.substring(6, 8);

                    // éªŒè¯æ—¥æœŸçš„æœ‰æ•ˆæ€§
                    const yearNum = parseInt(year);
                    const monthNum = parseInt(month);
                    const dayNum = parseInt(day);

                    if (yearNum >= 1900 && yearNum <= 2100 &&
                        monthNum >= 1 && monthNum <= 12 &&
                        dayNum >= 1 && dayNum <= 31) {
                        // è½¬æ¢ä¸ºä¸­æ–‡æ ¼å¼ï¼Œåªæ˜¾ç¤ºå¹´å’Œæœˆ
                        input.value = `${year}å¹´${month}æœˆ`;
                        showToast(`å·²è¯†åˆ«ï¼š${year}å¹´${month}æœˆ`);
                    }
                }
                // å¤„ç†ç®€å†™æ ¼å¼ï¼š202512 -> 2025å¹´12æœˆ
                else if (/^\d{6}$/.test(value)) {
                    const year = value.substring(0, 4);
                    const month = value.substring(4, 6);

                    const yearNum = parseInt(year);
                    const monthNum = parseInt(month);

                    if (yearNum >= 1900 && yearNum <= 2100 &&
                        monthNum >= 1 && monthNum <= 12) {
                        input.value = `${year}å¹´${month}æœˆ`;
                        showToast(`å·²è¯†åˆ«ï¼š${year}å¹´${month}æœˆ`);
                    }
                }
            }

            function generatePromptContent(topic, taskType, field, style, length, requirements) {
                const taskDescriptions = {
                    'literature-review': 'è¿›è¡Œå…¨é¢çš„æ–‡çŒ®ç»¼è¿°',
                    'hypothesis': 'ç”Ÿæˆç ”ç©¶å‡è®¾',
                    'methodology': 'è®¾è®¡ç ”ç©¶æ–¹æ³•',
                    'abstract': 'æ’°å†™å­¦æœ¯æ‘˜è¦',
                    'introduction': 'æ’°å†™å¼•è¨€éƒ¨åˆ†',
                    'discussion': 'æ’°å†™è®¨è®ºéƒ¨åˆ†',
                    'analysis': 'è¿›è¡Œæ•°æ®åˆ†æ',
                    'tool-recommendation': 'ç”Ÿæˆç§‘ç ”å·¥å…·æ¨èæ–‡ç« '
                };

                const lengthDescriptions = {
                    'short': 'ç®€æ´æ˜äº†ï¼Œå­—æ•°æ§åˆ¶åœ¨200-300å­—',
                    'medium': 'è¯¦ç»†é˜è¿°ï¼Œå­—æ•°æ§åˆ¶åœ¨500-800å­—',
                    'long': 'æ·±å…¥åˆ†æï¼Œå­—æ•°æ§åˆ¶åœ¨1000-1500å­—'
                };

                const styleDescriptions = {
                    'formal': 'ä½¿ç”¨æ­£å¼çš„å­¦æœ¯è¯­è¨€ï¼Œä¸¥è°¨å‡†ç¡®',
                    'casual': 'ä½¿ç”¨é€šä¿—æ˜“æ‡‚çš„è¯­è¨€ï¼Œä¾¿äºç†è§£',
                    'technical': 'ä½¿ç”¨ä¸“ä¸šæœ¯è¯­ï¼ŒæŠ€æœ¯æ€§å¼º'
                };

                // å¦‚æœæ˜¯ç§‘ç ”å·¥å…·æ¨èï¼Œç›´æ¥è¿”å›æ¨¡æ¿å†…å®¹
                if (taskType === 'tool-recommendation') {
                    return window.templates['research-tool-recommendation'].content;
                }

                let prompt = `è¯·ä»¥${styleDescriptions[style]}çš„æ–¹å¼ï¼Œé’ˆå¯¹"${topic}"è¿™ä¸€ä¸»é¢˜${taskDescriptions[taskType]}ã€‚\n\n`;
                prompt += `è¦æ±‚ï¼š\n`;
                prompt += `1. å­¦ç§‘é¢†åŸŸï¼š${field}\n`;
                prompt += `2. ç¯‡å¹…ï¼š${lengthDescriptions[length]}\n`;
                prompt += `3. å†™ä½œé£æ ¼ï¼š${styleDescriptions[style]}\n`;

                if (requirements) {
                    prompt += `4. é¢å¤–è¦æ±‚ï¼š${requirements}\n`;
                }

                prompt += `\nè¯·ç¡®ä¿å†…å®¹ï¼š\n`;
                prompt += `- é€»è¾‘æ¸…æ™°ï¼Œç»“æ„å®Œæ•´\n`;
                prompt += `- è®ºæ®å……åˆ†ï¼Œæœ‰ç†æœ‰æ®\n`;
                prompt += `- è¯­è¨€å‡†ç¡®ï¼Œè¡¨è¾¾ä¸“ä¸š\n`;
                prompt += `- ç¬¦åˆå­¦æœ¯è§„èŒƒå’Œå†™ä½œæ ‡å‡†\n`;

                if (taskType === 'literature-review') {
                    prompt += `\nåœ¨ç»¼è¿°ä¸­è¯·åŒ…å«ï¼š\n`;
                    prompt += `- ç ”ç©¶èƒŒæ™¯å’Œæ„ä¹‰\n`;
                    prompt += `- å›½å†…å¤–ç ”ç©¶ç°çŠ¶\n`;
                    prompt += `- ç ”ç©¶æ–¹æ³•å’Œä¸»è¦å‘ç°\n`;
                    prompt += `- å­˜åœ¨çš„é—®é¢˜å’Œæœªæ¥å±•æœ›\n`;
                }

                return prompt;
            }

            function copyOutput() {
                const output = document.getElementById('output').value;
                if (!output) {
                    showToast('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹');
                    return;
                }
                navigator.clipboard.writeText(output);
                showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            }

            function savePrompt() {
                const output = document.getElementById('output').value;
                if (!output) {
                    showToast('æ²¡æœ‰å¯ä¿å­˜çš„å†…å®¹');
                    return;
                }
                const prompts = JSON.parse(localStorage.getItem('savedPrompts') || '[]');
                prompts.unshift({
                    content: output,
                    date: new Date().toLocaleString('zh-CN')
                });
                if (prompts.length > 10) prompts.pop();
                localStorage.setItem('savedPrompts', JSON.stringify(prompts));
                showToast('å·²ä¿å­˜');
            }

            function clearOutput() {
                document.getElementById('output').value = '';
            }

            function showToast(message) {
                const toast = document.getElementById('toast');
                toast.textContent = message;
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 2000);
            }

            // Make functions global
            window.switchTab = switchTab;
            window.showTemplateModal = showTemplateModal;
            window.closeModal = closeModal;
            window.copyTemplate = copyTemplate;
            window.useTemplate = useTemplate;
            window.generatePrompt = generatePrompt;
            window.copyOutput = copyOutput;
            window.savePrompt = savePrompt;
            window.clearOutput = clearOutput;
            window.filterTemplates = filterTemplates;

            // Click outside modal to close
            document.getElementById('templateModal').addEventListener('click', (e) => {
                if (e.target.id === 'templateModal') {
                    closeModal();
                }
            });

            // å¯†ç éªŒè¯åŠŸèƒ½
            const CORRECT_PASSWORD = '962464';
            const PASSWORD_KEY = 'promptGeneratorAuthenticated';
            const PASSWORD_EXPIRY = 24 * 60 * 60 * 1000; // 24å°æ—¶æœ‰æ•ˆæœŸ

            // æ£€æŸ¥æ˜¯å¦å·²ç»éªŒè¯è¿‡
            function checkAuthentication() {
                const authData = localStorage.getItem(PASSWORD_KEY);
                if (!authData) return false;

                try {
                    const { timestamp } = JSON.parse(authData);
                    const now = new Date().getTime();

                    // æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
                    if (now - timestamp > PASSWORD_EXPIRY) {
                        localStorage.removeItem(PASSWORD_KEY);
                        return false;
                    }

                    return true;
                } catch (e) {
                    localStorage.removeItem(PASSWORD_KEY);
                    return false;
                }
            }

            // éªŒè¯å¯†ç 
            function checkPassword() {
                const input = document.getElementById('passwordInput');
                const error = document.getElementById('passwordError');
                const password = input.value.trim();

                if (password === CORRECT_PASSWORD) {
                    // ä¿å­˜éªŒè¯çŠ¶æ€
                    const authData = {
                        timestamp: new Date().getTime(),
                        authenticated: true
                    };
                    localStorage.setItem(PASSWORD_KEY, JSON.stringify(authData));

                    // éšè—å¯†ç æ¨¡æ€æ¡†ï¼Œæ˜¾ç¤ºä¸»è¦å†…å®¹
                    document.getElementById('passwordModal').style.display = 'none';
                    document.getElementById('mainContent').classList.add('authenticated');

                    showToast('éªŒè¯æˆåŠŸï¼æ¬¢è¿ä½¿ç”¨å­¦æœ¯æç¤ºè¯ç”Ÿæˆå™¨');
                } else {
                    error.style.display = 'block';
                    input.style.borderColor = '#ff4757';

                    // æ˜¾ç¤ºé”™è¯¯æç¤ºï¼Œä¸è‡ªåŠ¨æ¸…ç©ºè¾“å…¥ï¼Œæ–¹ä¾¿ç”¨æˆ·ä¿®æ”¹
                    setTimeout(() => {
                        error.style.display = 'none';
                        input.style.borderColor = '';
                    }, 3000);
                }
            }

            // å›è½¦é”®éªŒè¯
            document.getElementById('passwordInput').addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    checkPassword();
                }
            });

            // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥éªŒè¯çŠ¶æ€
            window.addEventListener('DOMContentLoaded', function () {
                if (checkAuthentication()) {
                    // å·²ç»éªŒè¯è¿‡ï¼Œç›´æ¥æ˜¾ç¤ºå†…å®¹
                    document.getElementById('passwordModal').style.display = 'none';
                    document.getElementById('mainContent').classList.add('authenticated');
                } else {
                    // éœ€è¦éªŒè¯ï¼Œæ˜¾ç¤ºå¯†ç æ¨¡æ€æ¡†
                    document.getElementById('passwordModal').style.display = 'flex';
                    document.getElementById('passwordInput').focus();
                }
            });

            // ä½¿å¯†ç éªŒè¯å‡½æ•°å…¨å±€å¯ç”¨
            window.checkPassword = checkPassword;
        </script>
        <script src="prompt-templates.js"></script>
</body>

</html>