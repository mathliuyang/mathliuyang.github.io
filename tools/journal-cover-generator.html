<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœŸåˆŠå°é¢å›¾ç‰‡ç”Ÿæˆå™¨ - AI for Science</title>
    <style>
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: rgba(30, 41, 59, 0.8);
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --accent: #3b82f6;
            --accent-hover: #2563eb;
            --border: #334155;
            --shadow: rgba(0, 0, 0, 0.3);
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
        }

        [data-theme="light"] {
            --bg-primary: #f8fafc;
            --bg-secondary: #e2e8f0;
            --bg-card: rgba(255, 255, 255, 0.9);
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --accent: #3b82f6;
            --accent-hover: #2563eb;
            --border: #d1d5db;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, var(--accent) 0%, transparent 70%);
            opacity: 0.1;
            border-radius: 50%;
            z-index: -1;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--accent) 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 2rem;
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            box-shadow: 0 8px 32px var(--shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px var(--shadow);
        }

        .card h2 {
            margin-bottom: 1.5rem;
            color: var(--text-primary);
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .file-upload {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .file-upload input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-upload-label {
            display: block;
            padding: 1rem;
            border: 2px dashed var(--border);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--bg-secondary);
        }

        .file-upload-label:hover {
            border-color: var(--accent);
            background: rgba(59, 130, 246, 0.05);
        }

        .file-upload-label.has-file {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.05);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .preview-area {
            position: relative;
            width: 100%;
            height: 400px;
            background: var(--bg-secondary);
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--border);
        }

        .preview-content {
            text-align: center;
            padding: 2rem;
            max-width: 100%;
        }

        .preview-series {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .preview-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .preview-subtitle {
            font-size: 1.5rem;
            color: var(--accent);
            margin-bottom: 1rem;
        }

        .preview-image {
            max-width: 200px;
            max-height: 150px;
            border-radius: 8px;
            margin: 1rem 0;
            box-shadow: 0 4px 12px var(--shadow);
        }

        .preview-info {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .status.show {
            transform: translateX(0);
        }

        .status.success {
            background: rgba(16, 185, 129, 0.9);
        }

        .status.error {
            background: rgba(239, 68, 68, 0.9);
        }

        .status.warning {
            background: rgba(245, 158, 11, 0.9);
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            z-index: 100;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        .instructions {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 2rem;
            margin-top: 2rem;
            border: 1px solid var(--border);
        }

        .instructions h3 {
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .instructions ul {
            margin-left: 1.5rem;
            color: var(--text-secondary);
        }

        .instructions li {
            margin-bottom: 0.5rem;
        }

        .shortcuts {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 1rem;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .btn-group {
                flex-direction: column;
            }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .image-colors {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .color-swatch {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 4px var(--shadow);
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .color-swatch:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <div class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">
        <span id="themeIcon">ğŸŒ™</span>
    </div>

    <div class="container">
        <div class="header">
            <h1>æœŸåˆŠå°é¢å›¾ç‰‡ç”Ÿæˆå™¨</h1>
            <p>ä¸º AI for Science æœŸåˆŠæ¨èç³»åˆ—åˆ›å»ºç²¾ç¾çš„å…¬ä¼—å·å°é¢å›¾ç‰‡</p>
        </div>

        <div class="main-content">
            <div class="card">
                <h2>ğŸ¨ é…ç½®å‚æ•°</h2>
                
                <div class="form-group">
                    <label for="quickTemplate">å¿«é€Ÿæ¨¡æ¿é€‰æ‹©</label>
                    <select id="quickTemplate" onchange="applyTemplate()">
                        <option value="">é€‰æ‹©æ¨¡æ¿...</option>
                        <option value="computational-physics">è®¡ç®—ç‰©ç†ç±»</option>
                        <option value="applied-mathematics">åº”ç”¨æ•°å­¦ç±»</option>
                        <option value="machine-learning">æœºå™¨å­¦ä¹ ç±»</option>
                        <option value="interdisciplinary">äº¤å‰å­¦ç§‘ç±»</option>
                        <option value="classical">ç»å…¸ç‰©ç†ç±»</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="journalName">æœŸåˆŠåç§°</label>
                    <input type="text" id="journalName" placeholder="ä¾‹å¦‚ï¼šJournal of Computational Physics" oninput="updatePreview()">
                </div>

                <div class="form-group">
                    <label for="seriesNumber">ç³»åˆ—ç¼–å·</label>
                    <input type="number" id="seriesNumber" value="01" min="1" max="999" oninput="updatePreview()">
                </div>

                <div class="form-group">
                    <label for="journalDescription">æœŸåˆŠæè¿°</label>
                    <textarea id="journalDescription" placeholder="ç®€è¦æè¿°æœŸåˆŠç‰¹è‰²..." rows="3" oninput="updatePreview()">è®¡ç®—ç‰©ç†é¢†åŸŸé¡¶çº§æœŸåˆŠï¼Œä¸“æ³¨äºç§‘å­¦è®¡ç®—å’Œæ•°å€¼æ–¹æ³•</textarea>
                </div>

                <div class="form-group">
                    <label>æœŸåˆŠå°é¢å›¾ç‰‡</label>
                    <div class="file-upload">
                        <input type="file" id="coverImage" accept="image/*" onchange="handleImageUpload(event)">
                        <label for="coverImage" class="file-upload-label" id="fileUploadLabel">
                            ğŸ“· ç‚¹å‡»ä¸Šä¼ å°é¢å›¾ç‰‡æˆ–æ‹–æ‹½åˆ°æ­¤å¤„
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="coverUrl">æˆ–è¾“å…¥å›¾ç‰‡é“¾æ¥</label>
                    <input type="url" id="coverUrl" placeholder="https://..." oninput="loadImageFromUrl()">
                </div>

                <div id="imageColors" class="image-colors" style="display: none;">
                    <label>è¯†åˆ«åˆ°çš„ä¸»è‰²è°ƒï¼š</label>
                    <div id="colorSwatches"></div>
                </div>

                <div class="form-group">
                    <label for="bgColor">èƒŒæ™¯é£æ ¼</label>
                    <select id="bgColor" onchange="updatePreview()">
                        <option value="dark">æ·±è‰²ä¸»é¢˜</option>
                        <option value="light">æµ…è‰²ä¸»é¢˜</option>
                        <option value="blue">è“è‰²ä¸»é¢˜</option>
                        <option value="gradient">æ¸å˜ä¸»é¢˜</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="fontSize">å­—ä½“å¤§å°</label>
                    <select id="fontSize" onchange="updatePreview()">
                        <option value="small">å°å­—ä½“</option>
                        <option value="medium" selected>ä¸­ç­‰å­—ä½“</option>
                        <option value="large">å¤§å­—ä½“</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="layoutStyle">å¸ƒå±€é£æ ¼</label>
                    <select id="layoutStyle" onchange="updatePreview()">
                        <option value="centered">å±…ä¸­å¸ƒå±€</option>
                        <option value="left">å·¦å¯¹é½</option>
                        <option value="modern">ç°ä»£é£æ ¼</option>
                    </select>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="downloadCover()">
                        <span>ğŸ“¥</span> ç”Ÿæˆå¹¶ä¸‹è½½
                    </button>
                    <button class="btn btn-secondary" onclick="resetForm()">
                        <span>ğŸ”„</span> é‡ç½®
                    </button>
                    <button class="btn btn-secondary" onclick="generateBatch()">
                        <span>âš¡</span> æ‰¹é‡ç”Ÿæˆ
                    </button>
                </div>

                <div class="shortcuts">
                    <strong>å¿«æ·é”®ï¼š</strong><br>
                    âŒ˜/Ctrl + Enter: ç”Ÿæˆå°é¢ | âŒ˜/Ctrl + R: é‡ç½®è®¾ç½® | âŒ˜/Ctrl + S: ä¸‹è½½å›¾ç‰‡
                </div>
            </div>

            <div class="card">
                <h2>ğŸ‘ï¸ å®æ—¶é¢„è§ˆ</h2>
                <div class="preview-area" id="previewArea">
                    <div class="preview-content">
                        <div class="preview-series" id="previewSeries">AI for Science Â· æœŸåˆŠæ¨èç³»åˆ—</div>
                        <div class="preview-title" id="previewTitle">Journal of Computational Physics</div>
                        <div class="preview-subtitle" id="previewSubtitle">No. 01</div>
                        <img id="previewImage" class="preview-image" style="display: none;">
                        <div class="preview-info" id="previewInfo">è®¡ç®—ç‰©ç†é¢†åŸŸé¡¶çº§æœŸåˆŠï¼Œä¸“æ³¨äºç§‘å­¦è®¡ç®—å’Œæ•°å€¼æ–¹æ³•</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="instructions">
            <h3>ğŸ“‹ ä½¿ç”¨è¯´æ˜</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                <div>
                    <h4>åŸºæœ¬æ­¥éª¤</h4>
                    <ul>
                        <li>è¾“å…¥æœŸåˆŠåç§°å’Œç³»åˆ—ç¼–å·</li>
                        <li>ä¸Šä¼ æœŸåˆŠå°é¢å›¾ç‰‡æˆ–è¾“å…¥å›¾ç‰‡é“¾æ¥</li>
                        <li>é€‰æ‹©åˆé€‚çš„èƒŒæ™¯é£æ ¼å’Œå­—ä½“å¤§å°</li>
                        <li>å®æ—¶é¢„è§ˆæ•ˆæœï¼Œè°ƒæ•´å‚æ•°</li>
                        <li>ç‚¹å‡»ç”Ÿæˆå¹¶ä¸‹è½½å°é¢å›¾ç‰‡</li>
                    </ul>
                </div>
                <div>
                    <h4>è®¾è®¡å»ºè®®</h4>
                    <ul>
                        <li>é€‰æ‹©é«˜è´¨é‡çš„æœŸåˆŠå°é¢å›¾ç‰‡</li>
                        <li>ä¿æŒæ–‡å­—ç®€æ´æ˜äº†ï¼Œé¿å…è¿‡å¤šä¿¡æ¯</li>
                        <li>æ ¹æ®æœŸåˆŠç‰¹è‰²é€‰æ‹©åˆé€‚çš„é…è‰²æ–¹æ¡ˆ</li>
                        <li>ç¡®ä¿æ–‡å­—ä¸èƒŒæ™¯æœ‰è¶³å¤Ÿçš„å¯¹æ¯”åº¦</li>
                        <li>é¢„è§ˆä¸åŒå°ºå¯¸ä¸‹çš„æ˜¾ç¤ºæ•ˆæœ</li>
                    </ul>
                </div>
                <div>
                    <h4>æ¨¡æ¿è¯´æ˜</h4>
                    <ul>
                        <li><strong>è®¡ç®—ç‰©ç†ç±»ï¼š</strong>è“è‰²è°ƒï¼Œçªå‡ºç§‘æŠ€æ„Ÿ</li>
                        <li><strong>åº”ç”¨æ•°å­¦ç±»ï¼š</strong>ç»¿è‰²è°ƒï¼Œä½“ç°ä¸¥è°¨æ€§</li>
                        <li><strong>æœºå™¨å­¦ä¹ ç±»ï¼š</strong>ç´«è‰²è°ƒï¼Œå±•ç°åˆ›æ–°æ€§</li>
                        <li><strong>äº¤å‰å­¦ç§‘ç±»ï¼š</strong>å¤šå½©è°ƒï¼Œå¼ºè°ƒèåˆæ€§</li>
                        <li><strong>ç»å…¸ç‰©ç†ç±»ï¼š</strong>é‡‘è‰²è°ƒï¼Œå½°æ˜¾æƒå¨æ€§</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div id="status" class="status"></div>

    <script>
        let uploadedImage = null;
        let imageColors = null;

        // ä¸»é¢˜åˆ‡æ¢
        function toggleTheme() {
            const html = document.documentElement;
            const themeIcon = document.getElementById('themeIcon');
            
            if (html.getAttribute('data-theme') === 'light') {
                html.removeAttribute('data-theme');
                themeIcon.textContent = 'ğŸŒ™';
                localStorage.setItem('theme', 'dark');
            } else {
                html.setAttribute('data-theme', 'light');
                themeIcon.textContent = 'â˜€ï¸';
                localStorage.setItem('theme', 'light');
            }
        }

        // åˆå§‹åŒ–ä¸»é¢˜
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            const themeIcon = document.getElementById('themeIcon');
            
            if (savedTheme === 'light') {
                document.documentElement.setAttribute('data-theme', 'light');
                themeIcon.textContent = 'â˜€ï¸';
            }
        }

        // æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯
        function showStatus(message, type = 'success') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.classList.add('show');
            
            setTimeout(() => {
                status.classList.remove('show');
            }, 3000);
        }

        // æ›´æ–°é¢„è§ˆ
        function updatePreview() {
            const journalName = document.getElementById('journalName').value || 'Journal of Computational Physics';
            const seriesNumber = document.getElementById('seriesNumber').value || '01';
            const journalDescription = document.getElementById('journalDescription').value || 'è®¡ç®—ç‰©ç†é¢†åŸŸé¡¶çº§æœŸåˆŠï¼Œä¸“æ³¨äºç§‘å­¦è®¡ç®—å’Œæ•°å€¼æ–¹æ³•';
            const bgColor = document.getElementById('bgColor').value;
            const fontSize = document.getElementById('fontSize').value;
            const layoutStyle = document.getElementById('layoutStyle').value;

            document.getElementById('previewSeries').textContent = 'AI for Science Â· æœŸåˆŠæ¨èç³»åˆ—';
            document.getElementById('previewTitle').textContent = journalName;
            document.getElementById('previewSubtitle').textContent = `No. ${seriesNumber}`;
            document.getElementById('previewInfo').textContent = journalDescription;

            const previewArea = document.getElementById('previewArea');
            const previewContent = document.querySelector('.preview-content');

            // åº”ç”¨èƒŒæ™¯é£æ ¼
            const bgColors = {
                dark: 'linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%)',
                light: 'linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)',
                blue: 'linear-gradient(135deg, #1e40af 0%, #3b82f6 100%)',
                gradient: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'
            };

            previewArea.style.background = bgColors[bgColor] || bgColors.dark;

            // åº”ç”¨å¸ƒå±€é£æ ¼
            if (layoutStyle === 'left') {
                previewContent.style.textAlign = 'left';
            } else if (layoutStyle === 'modern') {
                previewContent.style.textAlign = 'center';
                previewContent.style.padding = '3rem 2rem';
            } else {
                previewContent.style.textAlign = 'center';
                previewContent.style.padding = '2rem';
            }

            // åº”ç”¨å­—ä½“å¤§å°
            const fontSizes = {
                small: { series: '1rem', title: '1.5rem', subtitle: '1.2rem', info: '0.8rem' },
                medium: { series: '1.2rem', title: '2rem', subtitle: '1.5rem', info: '0.9rem' },
                large: { series: '1.4rem', title: '2.5rem', subtitle: '1.8rem', info: '1rem' }
            };

            const sizes = fontSizes[fontSize] || fontSizes.medium;
            document.getElementById('previewSeries').style.fontSize = sizes.series;
            document.getElementById('previewTitle').style.fontSize = sizes.title;
            document.getElementById('previewSubtitle').style.fontSize = sizes.subtitle;
            document.getElementById('previewInfo').style.fontSize = sizes.info;

            // è°ƒæ•´æ–‡å­—é¢œè‰²
            const textColors = {
                dark: '#ffffff',
                light: '#000000',
                blue: '#ffffff',
                gradient: '#ffffff'
            };

            const textColor = textColors[bgColor] || textColors.dark;
            document.getElementById('previewSeries').style.color = textColor;
            document.getElementById('previewTitle').style.color = textColor;
            document.getElementById('previewInfo').style.color = textColor;
        }

        // å¤„ç†å›¾ç‰‡ä¸Šä¼ 
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    uploadedImage = e.target.result;
                    const previewImage = document.getElementById('previewImage');
                    previewImage.src = uploadedImage;
                    previewImage.style.display = 'block';
                    
                    // æ›´æ–°æ–‡ä»¶ä¸Šä¼ æ ‡ç­¾
                    const label = document.getElementById('fileUploadLabel');
                    label.textContent = `ğŸ“· å·²é€‰æ‹©: ${file.name}`;
                    label.classList.add('has-file');
                    
                    // åˆ†æå›¾ç‰‡é¢œè‰²
                    analyzeImageColors(uploadedImage);
                    showStatus('å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼', 'success');
                };
                reader.readAsDataURL(file);
            }
        }

        // ä»URLåŠ è½½å›¾ç‰‡
        function loadImageFromUrl() {
            const url = document.getElementById('coverUrl').value;
            if (url) {
                uploadedImage = url;
                const previewImage = document.getElementById('previewImage');
                previewImage.src = uploadedImage;
                previewImage.style.display = 'block';
                
                // åˆ†æå›¾ç‰‡é¢œè‰²
                analyzeImageColors(url);
                showStatus('å›¾ç‰‡åŠ è½½æˆåŠŸï¼', 'success');
            }
        }

        // åˆ†æå›¾ç‰‡é¢œè‰²
        function analyzeImageColors(imageSrc) {
            const img = new Image();
            img.crossOrigin = 'anonymous';
            img.onload = function() {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const colors = extractMainColors(imageData);
                
                displayColorSwatches(colors);
                imageColors = colors;
                applySmartColorScheme();
            };
            img.src = imageSrc;
        }

        // æå–ä¸»è¦é¢œè‰²
        function extractMainColors(imageData) {
            const data = imageData.data;
            const colorMap = {};
            
            // é‡‡æ ·åƒç´ ï¼ˆæ¯10ä¸ªåƒç´ é‡‡æ ·ä¸€æ¬¡ï¼‰
            for (let i = 0; i < data.length; i += 40) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                const a = data[i + 3];
                
                if (a > 128) { // å¿½ç•¥é€æ˜åƒç´ 
                    const colorKey = `${Math.round(r/10)*10},${Math.round(g/10)*10},${Math.round(b/10)*10}`;
                    colorMap[colorKey] = (colorMap[colorKey] || 0) + 1;
                }
            }
            
            // æ’åºå¹¶è·å–å‰5ä¸ªä¸»è¦é¢œè‰²
            const sortedColors = Object.entries(colorMap)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5)
                .map(([color]) => {
                    const [r, g, b] = color.split(',').map(Number);
                    return { r, g, b, hsl: rgbToHsl(r, g, b) };
                });
            
            return sortedColors;
        }

        // RGBè½¬HSL
        function rgbToHsl(r, g, b) {
            r /= 255;
            g /= 255;
            b /= 255;
            
            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            let h, s, l = (max + min) / 2;
            
            if (max === min) {
                h = s = 0;
            } else {
                const d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                
                switch (max) {
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                }
                h /= 6;
            }
            
            return { h: h * 360, s: s * 100, l: l * 100 };
        }

        // æ˜¾ç¤ºé¢œè‰²æ ·æœ¬
        function displayColorSwatches(colors) {
            const container = document.getElementById('colorSwatches');
            const colorsDiv = document.getElementById('imageColors');
            
            container.innerHTML = '';
            colors.forEach(color => {
                const swatch = document.createElement('div');
                swatch.className = 'color-swatch';
                swatch.style.backgroundColor = `rgb(${color.r}, ${color.g}, ${color.b})`;
                swatch.title = `RGB(${color.r}, ${color.g}, ${color.b})`;
                container.appendChild(swatch);
            });
            
            colorsDiv.style.display = 'flex';
        }

        // åº”ç”¨æ™ºèƒ½é…è‰²æ–¹æ¡ˆ
        function applySmartColorScheme() {
            if (!imageColors || imageColors.length === 0) return;
            
            const primaryColor = imageColors[0];
            const bgColorSelect = document.getElementById('bgColor');
            
            // æ ¹æ®ä¸»è‰²è°ƒè‡ªåŠ¨é€‰æ‹©èƒŒæ™¯é£æ ¼
            const hsl = primaryColor.hsl;
            if (hsl.l > 70) {
                bgColorSelect.value = 'light';
            } else if (hsl.h > 200 && hsl.h < 280) {
                bgColorSelect.value = 'blue';
            } else if (hsl.s > 60) {
                bgColorSelect.value = 'gradient';
            } else {
                bgColorSelect.value = 'dark';
            }
            
            updatePreview();
            showStatus('å·²åº”ç”¨æ™ºèƒ½é…è‰²æ–¹æ¡ˆ', 'success');
        }

        // ä¸‹è½½å°é¢
        function downloadCover() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = 900;
            canvas.height = 500;
            
            // è·å–å½“å‰æ ·å¼è®¾ç½®
            const bgColor = document.getElementById('bgColor').value;
            const fontSize = document.getElementById('fontSize').value;
            const journalName = document.getElementById('journalName').value || 'Journal of Computational Physics';
            const seriesNumber = document.getElementById('seriesNumber').value || '01';
            const journalDescription = document.getElementById('journalDescription').value || 'è®¡ç®—ç‰©ç†é¢†åŸŸé¡¶çº§æœŸåˆŠï¼Œä¸“æ³¨äºç§‘å­¦è®¡ç®—å’Œæ•°å€¼æ–¹æ³•';
            
            // æ™ºèƒ½é…è‰²æ–¹æ¡ˆ
            let colorScheme = getSmartColorScheme();
            
            // èƒŒæ™¯æ¸å˜
            const bgGradients = {
                dark: ctx.createLinearGradient(0, 0, canvas.width, canvas.height),
                light: ctx.createLinearGradient(0, 0, canvas.width, canvas.height),
                blue: ctx.createLinearGradient(0, 0, canvas.width, canvas.height),
                gradient: ctx.createLinearGradient(0, 0, canvas.width, canvas.height)
            };
            
            // æ ¹æ®å›¾ç‰‡é¢œè‰²æ™ºèƒ½è°ƒæ•´èƒŒæ™¯è‰²
            if (imageColors && imageColors.length > 0) {
                const primaryColor = imageColors[0];
                bgGradients.dark.addColorStop(0, `rgb(${primaryColor.r * 0.3}, ${primaryColor.g * 0.3}, ${primaryColor.b * 0.3})`);
                bgGradients.dark.addColorStop(1, `rgb(${primaryColor.r * 0.1}, ${primaryColor.g * 0.1}, ${primaryColor.b * 0.1})`);
                
                bgGradients.light.addColorStop(0, `rgb(${Math.min(255, primaryColor.r + 100)}, ${Math.min(255, primaryColor.g + 100)}, ${Math.min(255, primaryColor.b + 100)})`);
                bgGradients.light.addColorStop(1, `rgb(${Math.min(255, primaryColor.r + 50)}, ${Math.min(255, primaryColor.g + 50)}, ${Math.min(255, primaryColor.b + 50)})`);
                
                bgGradients.blue.addColorStop(0, `rgb(${primaryColor.r * 0.5}, ${primaryColor.g * 0.7}, ${Math.min(255, primaryColor.b + 50)})`);
                bgGradients.blue.addColorStop(1, `rgb(${primaryColor.r * 0.3}, ${primaryColor.g * 0.5}, ${Math.min(255, primaryColor.b + 30)})`);
                
                bgGradients.gradient.addColorStop(0, `rgb(${primaryColor.r}, ${primaryColor.g}, ${primaryColor.b})`);
                bgGradients.gradient.addColorStop(1, `rgb(${primaryColor.r * 0.6}, ${primaryColor.g * 0.6}, ${primaryColor.b * 0.6})`);
            } else {
                // é»˜è®¤æ¸å˜
                bgGradients.dark.addColorStop(0, '#1a1a1a');
                bgGradients.dark.addColorStop(1, '#2d2d2d');
                
                bgGradients.light.addColorStop(0, '#f8f9fa');
                bgGradients.light.addColorStop(1, '#e9ecef');
                
                bgGradients.blue.addColorStop(0, '#1e40af');
                bgGradients.blue.addColorStop(1, '#3b82f6');
                
                bgGradients.gradient.addColorStop(0, '#667eea');
                bgGradients.gradient.addColorStop(1, '#764ba2');
            }
            
            ctx.fillStyle = bgGradients[bgColor] || bgGradients.dark;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // æ·»åŠ è£…é¥°æ€§å…ƒç´ ï¼Œä½¿ç”¨åè°ƒçš„é¢œè‰²
            const decorColor = colorScheme.secondary || 'rgba(255, 255, 255, 0.1)';
            ctx.fillStyle = decorColor;
            ctx.beginPath();
            ctx.arc(canvas.width - 100, 100, 150, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.beginPath();
            ctx.arc(100, canvas.height - 100, 100, 0, Math.PI * 2);
            ctx.fill();
            
            // æ™ºèƒ½æ–‡å­—é¢œè‰²ï¼Œç¡®ä¿å¯¹æ¯”åº¦
            const textColor = getContrastColor(colorScheme.primary || bgGradients[bgColor]);
            ctx.fillStyle = textColor;
            
            // å­—ä½“å¤§å°é…ç½®
            const fontSizes = {
                small: { series: '18px', title: '36px', subtitle: '24px', info: '14px' },
                medium: { series: '24px', title: '48px', subtitle: '32px', info: '18px' },
                large: { series: '28px', title: '56px', subtitle: '40px', info: '20px' }
            };
            
            const sizes = fontSizes[fontSize] || fontSizes.medium;
            
            // ç³»åˆ—æ ‡é¢˜
            ctx.font = `500 ${sizes.series} -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif`;
            ctx.textAlign = 'center';
            ctx.fillText('AI for Science Â· æœŸåˆŠæ¨èç³»åˆ—', canvas.width/2, 80);
            
            // ä¸»æ ‡é¢˜
            ctx.font = `600 ${sizes.title} -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif`;
            ctx.fillText(journalName, canvas.width/2, 140);
            
            // ç¼–å·
            ctx.font = `500 ${sizes.subtitle} -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif`;
            ctx.fillText(`No. ${seriesNumber}`, canvas.width/2, 190);
            
            // æœŸåˆŠæè¿°ï¼Œä½¿ç”¨è¾…åŠ©è‰²ç¡®ä¿å±‚æ¬¡
            const descColor = colorScheme.tertiary || (bgColor === 'light' ? '#666666' : '#cccccc');
            ctx.fillStyle = descColor;
            ctx.font = `400 ${sizes.info} -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif`;
            ctx.fillText(journalDescription, canvas.width/2, 420);
            
            // åº•éƒ¨è£…é¥°çº¿ï¼Œä½¿ç”¨ä¸»è‰²è°ƒ
            ctx.strokeStyle = colorScheme.primary || textColor;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(50, canvas.height - 60);
            ctx.lineTo(canvas.width - 50, canvas.height - 60);
            ctx.stroke();
            
            // å“ç‰Œæ ‡è¯†
            ctx.font = `500 16px -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif`;
            ctx.fillStyle = colorScheme.accent || textColor;
            ctx.textAlign = 'right';
            ctx.fillText('å›¾çµçš„çŒ«', canvas.width - 50, canvas.height - 30);
            
            // æ·»åŠ æœŸåˆŠå°é¢å›¾ç‰‡ï¼ˆå¦‚æœæœ‰ï¼‰
            if (uploadedImage) {
                const img = new Image();
                img.onload = function() {
                    // è®¡ç®—å›¾ç‰‡ä½ç½®å’Œå¤§å°
                    const imgWidth = 200;
                    const imgHeight = (img.height / img.width) * imgWidth;
                    const x = (canvas.width - imgWidth) / 2;
                    const y = 220;
                    
                    // æ·»åŠ å›¾ç‰‡é˜´å½±ï¼Œä½¿ç”¨åè°ƒçš„é¢œè‰²
                    const shadowColor = colorScheme.shadow || 'rgba(0, 0, 0, 0.3)';
                    ctx.shadowColor = shadowColor;
                    ctx.shadowBlur = 20;
                    ctx.shadowOffsetX = 0;
                    ctx.shadowOffsetY = 10;
                    
                    // ç»˜åˆ¶å›¾ç‰‡
                    ctx.drawImage(img, x, y, imgWidth, imgHeight);
                    
                    // é‡ç½®é˜´å½±
                    ctx.shadowColor = 'transparent';
                    ctx.shadowBlur = 0;
                    ctx.shadowOffsetX = 0;
                    ctx.shadowOffsetY = 0;
                    
                    // ä¸‹è½½å›¾ç‰‡
                    downloadCanvas();
                };
                img.onerror = function() {
                    showStatus('å°é¢å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œå°†ç”Ÿæˆæ— å›¾ç‰‡ç‰ˆæœ¬', 'warning');
                    downloadCanvas();
                };
                img.src = uploadedImage;
            } else {
                downloadCanvas();
            }
            
            function downloadCanvas() {
                // ä¸‹è½½å›¾ç‰‡
                const link = document.createElement('a');
                link.download = `AI_for_Science_æœŸåˆŠæ¨è_${journalName.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g, '_')}.png`;
                link.href = canvas.toDataURL('image/png', 1.0);
                link.click();
                
                showStatus('å°é¢å›¾ç‰‡ä¸‹è½½æˆåŠŸï¼', 'success');
            }
        }

        // è·å–æ™ºèƒ½é…è‰²æ–¹æ¡ˆ
        function getSmartColorScheme() {
            if (!imageColors || imageColors.length === 0) {
                return {
                    primary: '#ffffff',
                    secondary: 'rgba(255, 255, 255, 0.1)',
                    tertiary: '#cccccc',
                    accent: '#ffffff',
                    shadow: 'rgba(0, 0, 0, 0.3)'
                };
            }
            
            const primary = imageColors[0];
            const primaryHsl = primary.hsl;
            
            return {
                primary: `rgb(${primary.r}, ${primary.g}, ${primary.b})`,
                secondary: `rgba(${primary.r}, ${primary.g}, ${primary.b}, 0.3)`,
                tertiary: `rgb(${Math.min(255, primary.r + 60)}, ${Math.min(255, primary.g + 60)}, ${Math.min(255, primary.b + 60)})`,
                accent: `rgb(${Math.min(255, primary.r + 30)}, ${Math.min(255, primary.g + 30)}, ${Math.min(255, primary.b + 30)})`,
                shadow: `rgba(${Math.floor(primary.r * 0.2)}, ${Math.floor(primary.g * 0.2)}, ${Math.floor(primary.b * 0.2)}, 0.3)`
            };
        }

        // è·å–å¯¹æ¯”è‰²ï¼Œç¡®ä¿æ–‡å­—æ¸…æ™°
        function getContrastColor(backgroundColor) {
            if (!imageColors || imageColors.length === 0) {
                return (document.getElementById('bgColor').value === 'light') ? '#000000' : '#ffffff';
            }
            
            // è®¡ç®—èƒŒæ™¯äº®åº¦
            const bgColor = imageColors[0];
            const luminance = (0.299 * bgColor.r + 0.587 * bgColor.g + 0.114 * bgColor.b) / 255;
            
            return luminance > 0.5 ? '#000000' : '#ffffff';
        }

        // æ¨¡æ¿æ•°æ®
        const templates = {
            'computational-physics': {
                bgColor: 'blue',
                fontSize: 'medium',
                layoutStyle: 'centered',
                description: 'è®¡ç®—ç‰©ç†é¢†åŸŸé¡¶çº§æœŸåˆŠï¼Œä¸“æ³¨äºç§‘å­¦è®¡ç®—å’Œæ•°å€¼æ–¹æ³•'
            },
            'applied-mathematics': {
                bgColor: 'gradient',
                fontSize: 'medium',
                layoutStyle: 'left',
                description: 'åº”ç”¨æ•°å­¦æƒå¨æœŸåˆŠï¼Œæ¶µç›–æ•°å­¦å»ºæ¨¡å’Œç†è®ºåˆ†æ'
            },
            'machine-learning': {
                bgColor: 'gradient',
                fontSize: 'large',
                layoutStyle: 'modern',
                description: 'æœºå™¨å­¦ä¹ å‰æ²¿æœŸåˆŠï¼Œæ¢ç´¢AIæŠ€æœ¯çš„æœ€æ–°è¿›å±•'
            },
            'interdisciplinary': {
                bgColor: 'gradient',
                fontSize: 'medium',
                layoutStyle: 'centered',
                description: 'äº¤å‰å­¦ç§‘ç ”ç©¶æœŸåˆŠï¼Œä¿ƒè¿›å¤šå­¦ç§‘èåˆå‘å±•'
            },
            'classical': {
                bgColor: 'dark',
                fontSize: 'medium',
                layoutStyle: 'centered',
                description: 'ç»å…¸ç‰©ç†å­¦æœŸåˆŠï¼Œä¼ æ‰¿ç‰©ç†å­¦çš„åŸºç¡€ç†è®º'
            }
        };

        // åº”ç”¨æ¨¡æ¿
        function applyTemplate() {
            const template = document.getElementById('quickTemplate').value;
            if (template && templates[template]) {
                const config = templates[template];
                document.getElementById('bgColor').value = config.bgColor;
                document.getElementById('fontSize').value = config.fontSize;
                document.getElementById('layoutStyle').value = config.layoutStyle;
                document.getElementById('journalDescription').value = config.description;
                
                updatePreview();
                showStatus(`å·²åº”ç”¨${template}æ¨¡æ¿`, 'success');
            }
        }

        // é‡ç½®è¡¨å•
        function resetForm() {
            document.getElementById('journalName').value = '';
            document.getElementById('seriesNumber').value = '01';
            document.getElementById('journalDescription').value = 'è®¡ç®—ç‰©ç†é¢†åŸŸé¡¶çº§æœŸåˆŠï¼Œä¸“æ³¨äºç§‘å­¦è®¡ç®—å’Œæ•°å€¼æ–¹æ³•';
            document.getElementById('coverImage').value = '';
            document.getElementById('coverUrl').value = '';
            document.getElementById('bgColor').value = 'dark';
            document.getElementById('fontSize').value = 'medium';
            document.getElementById('layoutStyle').value = 'centered';
            document.getElementById('quickTemplate').value = '';
            
            uploadedImage = null;
            imageColors = null;
            
            document.getElementById('previewImage').style.display = 'none';
            document.getElementById('fileUploadLabel').textContent = 'ğŸ“· ç‚¹å‡»ä¸Šä¼ å°é¢å›¾ç‰‡æˆ–æ‹–æ‹½åˆ°æ­¤å¤„';
            document.getElementById('fileUploadLabel').classList.remove('has-file');
            document.getElementById('imageColors').style.display = 'none';
            
            updatePreview();
            showStatus('å·²é‡ç½®æ‰€æœ‰è®¾ç½®', 'success');
        }

        // æ‰¹é‡ç”Ÿæˆ
        function generateBatch() {
            const journals = [
                { name: 'Journal of Computational Physics', number: '01' },
                { name: 'Computer Methods in Applied Mechanics', number: '02' },
                { name: 'SIAM Journal on Scientific Computing', number: '03' }
            ];
            
            journals.forEach((journal, index) => {
                setTimeout(() => {
                    document.getElementById('journalName').value = journal.name;
                    document.getElementById('seriesNumber').value = journal.number;
                    updatePreview();
                    
                    setTimeout(() => {
                        downloadCover();
                    }, 500);
                }, index * 2000);
            });
            
            showStatus('å¼€å§‹æ‰¹é‡ç”Ÿæˆï¼Œè¯·ç¨å€™...', 'success');
        }

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'Enter':
                        e.preventDefault();
                        downloadCover();
                        break;
                    case 'r':
                        e.preventDefault();
                        resetForm();
                        break;
                    case 's':
                        e.preventDefault();
                        downloadCover();
                        break;
                }
            }
        });

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initTheme();
            updatePreview();
            
            // æ‹–æ‹½ä¸Šä¼ 
            const fileUpload = document.querySelector('.file-upload-label');
            
            fileUpload.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.style.borderColor = 'var(--accent)';
                this.style.background = 'rgba(59, 130, 246, 0.1)';
            });
            
            fileUpload.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.style.borderColor = 'var(--border)';
                this.style.background = 'var(--bg-secondary)';
            });
            
            fileUpload.addEventListener('drop', function(e) {
                e.preventDefault();
                this.style.borderColor = 'var(--border)';
                this.style.background = 'var(--bg-secondary)';
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    document.getElementById('coverImage').files = files;
                    handleImageUpload({ target: { files: files } });
                }
            });
        });
    </script>
</body>
</html>